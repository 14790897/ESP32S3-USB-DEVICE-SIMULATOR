# ESP32-S3 USB MSC 快速入门指南

## 🚀 快速开始

### 1. 环境准备
```bash
# 克隆或下载项目到本地
# 确保已安装 PlatformIO
pio --version
```

### 2. 选择实现版本

#### 方法A: 使用脚本切换 (推荐)
```bash
# Linux/Mac
./switch_version.sh native    # ESP32原生版本 (推荐新手)
./switch_version.sh tinyusb   # TinyUSB基础版本
./switch_version.sh advanced  # TinyUSB高级版本

# Windows
switch_version.bat native     # ESP32原生版本 (推荐新手)
switch_version.bat tinyusb    # TinyUSB基础版本
switch_version.bat advanced   # TinyUSB高级版本
```

#### 方法B: 手动切换
1. 备份当前 `src/main.cpp`
2. 从相应目录复制文件到 `src/main.cpp`
3. 更新 `platformio.ini` 配置

### 3. 编译和上传
```bash
# 编译项目
pio run

# 上传到ESP32-S3
pio run --target upload

# 查看串口输出
pio device monitor
```

### 4. 测试功能
1. **连接设备**: 使用USB数据线连接ESP32-S3到电脑
2. **查看驱动器**: 在电脑上应该会出现新的USB驱动器
3. **测试读写**: 尝试在驱动器中创建/删除文件

## 📋 版本对比

| 版本 | 优点 | 缺点 | 适用场景 |
|------|------|------|----------|
| **ESP32原生** | 简单稳定、代码量少 | 功能基础 | 学习测试、简单应用 |
| **TinyUSB基础** | 跨平台、功能丰富 | 复杂度高 | 专业开发 |
| **TinyUSB高级** | 完整文件系统 | 内存占用大 | 产品级应用 |

## 🛠️ 常见问题

### Q: 设备无法识别？
**A**: 检查USB连接线是否支持数据传输，确认GPIO19/20连接正确

### Q: 编译失败？
**A**: 
1. 确认PlatformIO版本 >= 6.0
2. 清理缓存: `pio run --target clean`
3. 检查依赖库版本

### Q: 文件无法写入？
**A**: 
1. 检查回调函数实现
2. 确认RAM磁盘大小设置
3. 查看串口调试信息

### Q: 频繁重启？
**A**: 
1. 切换到ESP32原生版本
2. 检查内存使用情况
3. 降低时钟频率测试

## 📁 项目结构
```
S3-card/
├── src/
│   └── main.cpp              # 当前活动版本
├── tinyusb_version/
│   ├── main.cpp             # TinyUSB基础版本
│   ├── tinyusb_advanced.cpp # TinyUSB高级版本
│   └── platformio.ini       # TinyUSB配置
├── platformio.ini           # 当前项目配置
├── switch_version.sh        # 版本切换脚本(Linux/Mac)
├── switch_version.bat       # 版本切换脚本(Windows)
└── README.md               # 项目说明
```

## 🔧 高级配置

### 修改磁盘大小
```cpp
// ESP32原生版本
#define DISK_SECTOR_COUNT 64  // 32KB = 64 * 512字节

// TinyUSB版本
static uint8_t msc_disk[8192];  // 8KB RAM磁盘
```

### 自定义USB描述符
```cpp
// 在setup()中修改
USB.productName("我的USB设备");
USB.manufacturerName("我的公司");
```

### 添加文件内容
```cpp
// 参考 tinyusb_advanced.cpp 中的文件系统创建函数
void create_fat12_filesystem() {
    // 在这里添加您的文件...
}
```

## 📚 更多资源

- [ESP32-S3技术参考手册](https://docs.espressif.com/projects/esp-idf/en/latest/esp32s3/)
- [TinyUSB官方文档](https://docs.tinyusb.org/)
- [PlatformIO ESP32开发指南](https://docs.platformio.org/en/latest/platforms/espressif32.html)

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！